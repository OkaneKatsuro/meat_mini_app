version: '3.8'

services:
  # NestJS API
  api:
    build:
      context: .
      dockerfile: apps/api/Dockerfile
    container_name: meat_api
    restart: unless-stopped
    ports:
      - "3553:3553"
    environment:
      NODE_ENV: production
      PORT: 3553
      DATABASE_URL: postgresql://gen_user:std!Y8XUk-RF%3BV@185.211.170.182:5432/meat
      FRONTEND_URL: https://meat-bot.fluttrium.com
    networks:
      - meat_network

  # Next.js Web App
  web:
    build:
      context: .
      dockerfile: apps/web/Dockerfile
      args:
        NEXT_PUBLIC_API_URL: https://meat-bot.fluttrium.com/api
    container_name: meat_web
    restart: unless-stopped
    ports:
      - "3443:3443"
    environment:
      NODE_ENV: production
      PORT: 3443
      NEXT_PUBLIC_API_URL: https://meat-bot.fluttrium.com/api
    depends_on:
      - api
    networks:
      - meat_network

  # Telegram Bot
  bot:
    build:
      context: .
      dockerfile: apps/bot/Dockerfile
    container_name: meat_bot
    restart: unless-stopped
    environment:
      NODE_ENV: production
      BOT_TOKEN: 8475379548:AAHczG4WPWPCIW86dJpuF8bpAiUivoAsfD0
      MINI_APP_URL: https://meat-bot.fluttrium.com
    depends_on:
      - web
      - api
    networks:
      - meat_network

networks:
  meat_network:
    driver: bridge
